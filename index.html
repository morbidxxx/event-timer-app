<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Timer - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π</title>
    <meta name="theme-color" content="#8B5CF6">
    <meta name="description" content="–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π —Å —Ç–∞–π–º–µ—Ä–∞–º–∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'pulse': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        .safe-area-inset-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.3);
            border-radius: 2px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.5);
        }
        
        body {
            margin: 0;
            overflow-x: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        
        .backdrop-blur-lg {
            backdrop-filter: blur(16px);
        }
        
        .backdrop-blur-sm {
            backdrop-filter: blur(4px);
        }

        .backdrop-blur-light {
            backdrop-filter: blur(2px);
        }
        
        .photo-preview {
            aspect-ratio: 16/9;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .photo-preview:hover {
            transform: scale(1.02);
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 0.75rem;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script type="module">
        // –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
        const storage = {
            get: (key, defaultValue = null) => {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : defaultValue;
                } catch {
                    return defaultValue;
                }
            },
            set: (key, value) => {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (error) {
                    console.warn('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:', error);
                }
            }
        };

        // –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏
        class PhotoManager {
            constructor() {
                this.dbName = 'EventTimerPhotos';
                this.version = 1;
                this.storeName = 'userPhotos';
                this.init();
            }

            async init() {
                try {
                    this.db = await this.initDB();
                } catch (error) {
                    console.warn('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:', error);
                }
            }

            initDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.version);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => resolve(request.result);
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains(this.storeName)) {
                            const store = db.createObjectStore(this.storeName, { keyPath: 'id' });
                            store.createIndex('name', 'name', { unique: false });
                            store.createIndex('createdAt', 'createdAt', { unique: false });
                        }
                    };
                });
            }

            async savePhoto(file, customName = null) {
                if (!this.db) return null;
                
                const id = `photo_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        const transaction = this.db.transaction([this.storeName], 'readwrite');
                        const store = transaction.objectStore(this.storeName);
                        
                        const photoData = {
                            id,
                            name: customName || file.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ñ–æ–Ω',
                            blob: e.target.result,
                            size: file.size,
                            type: file.type,
                            createdAt: new Date().toISOString()
                        };

                        const request = store.add(photoData);
                        request.onsuccess = () => resolve({ id, url: e.target.result, name: photoData.name });
                        request.onerror = () => reject(request.error);
                    };
                    reader.onerror = () => reject(reader.error);
                    reader.readAsDataURL(file);
                });
            }

            async getAllPhotos() {
                if (!this.db) return [];
                
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([this.storeName], 'readonly');
                    const store = transaction.objectStore(this.storeName);
                    const request = store.getAll();
                    
                    request.onsuccess = () => {
                        const photos = request.result.map(photo => ({
                            id: photo.id,
                            name: photo.name,
                            url: photo.blob,
                            size: photo.size,
                            createdAt: photo.createdAt
                        }));
                        resolve(photos);
                    };
                    request.onerror = () => reject(request.error);
                });
            }

            async deletePhoto(id) {
                if (!this.db) return false;
                
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([this.storeName], 'readwrite');
                    const store = transaction.objectStore(this.storeName);
                    const request = store.delete(id);
                    
                    request.onsuccess = () => resolve(true);
                    request.onerror = () => reject(request.error);
                });
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
        const photoManager = new PhotoManager();

        // –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        class EventTimerApp {
            constructor() {
                this.events = storage.get('events', []);
                this.currentTab = 'home';
                this.showEventModal = false;
                this.showSettingsModal = false;

                this.editingEvent = null;
                this.isDark = storage.get('darkMode', true);
                this.backgroundImage = storage.get('backgroundImage', null);
                this.userPhotos = [];
                this.isFormActive = false; // –§–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã
                this.activeNotifications = storage.get('activeNotifications', []);
                this.currentMonth = new Date().getMonth();
                this.currentYear = new Date().getFullYear();
                this.notificationsEnabled = storage.get('notificationsEnabled', true);
                this.staticEvents = this.generateStaticEvents();
                
                this.eventForm = {
                    title: '',
                    date: '',
                    time: '',
                    description: '',
                    color: '#8B5CF6',
                    notifications: []
                };

                this.loadUserPhotos();
                this.render();
                this.startTimer();
                this.checkNotifications();
            }

            async loadUserPhotos() {
                try {
                    this.userPhotos = await photoManager.getAllPhotos();
                    this.render();
                } catch (error) {
                    console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:', error);
                }
            }

            startTimer() {
                setInterval(() => {
                    // –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞ –∞–∫—Ç–∏–≤–Ω–∞, –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º –Ω–∏—á–µ–≥–æ
                    if (this.isFormActive) return;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–∞–π–º–µ—Ä—ã, –Ω–µ –≤—Å—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    this.updateTimers();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
                    if (new Date().getSeconds() === 0) {
                        this.checkNotifications();
                    }
                }, 1000);
            }

            updateTimers() {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–∞–π–º–µ—Ä–∞–º–∏, –∏–∑–±–µ–≥–∞—è –ø–æ–ª–Ω–æ–≥–æ —Ä–µ—Ä–µ–Ω–¥–µ—Ä–∞
                const timerElements = document.querySelectorAll('[data-timer-event]');
                timerElements.forEach(element => {
                    const eventId = element.getAttribute('data-timer-event');
                    const event = this.events.find(e => e.id == eventId);
                    if (event) {
                        element.innerHTML = this.renderTimerDisplayOnly(event);
                    }
                });
            }

            calculateTimeLeft(eventDate) {
                const now = new Date();
                const target = new Date(eventDate);
                const difference = target - now;

                if (difference > 0) {
                    const days = Math.floor(difference / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((difference / (1000 * 60 * 60)) % 24);
                    const minutes = Math.floor((difference / 1000 / 60) % 60);
                    const seconds = Math.floor((difference / 1000) % 60);

                    return { days, hours, minutes, seconds, expired: false };
                }

                return { days: 0, hours: 0, minutes: 0, seconds: 0, expired: true };
            }

            getUpcomingEvents() {
                const now = new Date();
                const thirtyDaysFromNow = new Date(now.getTime() + (30 * 24 * 60 * 60 * 1000));
                
                return this.getAllEvents()
                    .filter(event => {
                        const eventDate = new Date(event.dateTime);
                        const timeLeft = this.calculateTimeLeft(event.dateTime);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è –∫–æ—Ç–æ—Ä—ã–µ:
                        // 1. –ï—â–µ –Ω–µ –ø—Ä–æ—à–ª–∏
                        // 2. –ü—Ä–æ–∏–∑–æ–π–¥—É—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö 30 –¥–Ω–µ–π
                        return !timeLeft.expired && eventDate <= thirtyDaysFromNow;
                    })
                    .sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime))
                    .slice(0, 5); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ 5 –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
            }

            addEvent() {
                if (!this.eventForm.title || !this.eventForm.date) return;

                const newEvent = {
                    id: Date.now(),
                    ...this.eventForm,
                    dateTime: `${this.eventForm.date}T${this.eventForm.time || '12:00'}`,
                    createdAt: new Date().toISOString()
                };

                this.events.push(newEvent);
                storage.set('events', this.events);
                this.resetForm();
                this.showEventModal = false;
                this.isFormActive = false; // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É
                this.render();
            }



            editEvent() {
                if (!this.eventForm.title || !this.eventForm.date) return;

                const updatedEvent = {
                    ...this.editingEvent,
                    ...this.eventForm,
                    dateTime: `${this.eventForm.date}T${this.eventForm.time || '12:00'}`
                };

                this.events = this.events.map(event => 
                    event.id === this.editingEvent.id ? updatedEvent : event
                );
                
                storage.set('events', this.events);
                this.resetForm();
                this.showEventModal = false;
                this.editingEvent = null;
                this.isFormActive = false; // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É
                this.render();
            }

            deleteEvent(id) {
                this.events = this.events.filter(event => event.id !== id);
                storage.set('events', this.events);
                this.render();
            }

            resetForm() {
                this.eventForm = {
                    title: '',
                    date: '',
                    time: '',
                    description: '',
                    color: '#8B5CF6',
                    notifications: []
                };
            }

            setTheme(isDark) {
                this.isDark = isDark;
                storage.set('darkMode', isDark);
                this.render();
            }

            setBackgroundImage(imageUrl) {
                this.backgroundImage = imageUrl;
                storage.set('backgroundImage', imageUrl);
                this.render();
            }
            
            setBackgroundGradient(gradient) {
                this.backgroundImage = gradient;
                storage.set('backgroundImage', gradient);
                this.render();
            }

            async handlePhotoUpload(file) {
                try {
                    const result = await photoManager.savePhoto(file);
                    if (result) {
                        await this.loadUserPhotos();
                        this.setBackgroundImage(result.url);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏');
                }
            }

            async deletePhoto(photoId) {
                try {
                    await photoManager.deletePhoto(photoId);
                    
                    // –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º–æ–µ —Ñ–æ—Ç–æ –±—ã–ª–æ —Ñ–æ–Ω–æ–º, —Å–±—Ä–æ—Å–∏—Ç—å —Ñ–æ–Ω
                    const deletedPhoto = this.userPhotos.find(p => p.id === photoId);
                    if (deletedPhoto && this.backgroundImage === deletedPhoto.url) {
                        this.setBackgroundImage(null);
                    }
                    
                    await this.loadUserPhotos();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:', error);
                }
            }

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
            generateStaticEvents() {
                const currentYear = new Date().getFullYear();
                const staticEvents = [];
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –Ω–∞ —Ç–µ–∫—É—â–∏–π –∏ —Å–ª–µ–¥—É—é—â–∏–π –≥–æ–¥
                for (let year = currentYear; year <= currentYear + 1; year++) {
                    for (let month = 0; month < 12; month++) {
                        // –ê–≤–∞–Ω—Å 15 —á–∏—Å–ª–∞
                        const advanceDate = new Date(year, month, 15, 9, 0); // 09:00
                        staticEvents.push({
                            id: `advance-${year}-${month}`,
                            title: '–ó–∞—Ä–ø–ª–∞—Ç–∫–∞ üí∞',
                            dateTime: advanceDate.toISOString(),
                            description: '–í—ã–ø–ª–∞—Ç–∞ –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç—ã',
                            color: '#10B981', // –ó–µ–ª–µ–Ω—ã–π
                            isStatic: true,
                            type: 'advance'
                        });

                        // –ó–ü 30 —á–∏—Å–ª–∞ (–∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞)
                        const lastDay = new Date(year, month + 1, 0).getDate();
                        const salaryDay = Math.min(30, lastDay);
                        const salaryDate = new Date(year, month, salaryDay, 17, 0); // 17:00
                        staticEvents.push({
                            id: `salary-${year}-${month}`,
                            title: '–ê–í–ê–ù–° üí∏',
                            dateTime: salaryDate.toISOString(),
                            description: '–ê–∞–Ω—Å –ø–æ –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç–µ',
                            color: '#F59E0B', // –û—Ä–∞–Ω–∂–µ–≤—ã–π
                            isStatic: true,
                            type: 'salary'
                        });
                    }
                }
                
                return staticEvents;
            }

            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ + —Å—Ç–∞—Ç–∏—á–Ω—ã–µ)
            getAllEvents() {
                const now = new Date();
                const futureStaticEvents = this.staticEvents.filter(event => 
                    new Date(event.dateTime) > now
                );
                return [...this.events, ...futureStaticEvents];
            }

            // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
            toggleNotifications() {
                this.notificationsEnabled = !this.notificationsEnabled;
                storage.set('notificationsEnabled', this.notificationsEnabled);
                
                if (!this.notificationsEnabled) {
                    // –û—á–∏—â–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
                    this.activeNotifications = [];
                    storage.set('activeNotifications', []);
                }
                this.render();
            }

            checkNotifications() {
                if (!this.notificationsEnabled) return;
                const now = new Date();
                const newNotifications = [];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ, —Ç–∞–∫ –∏ —Å—Ç–∞—Ç–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
                const allEvents = this.getAllEvents();

                allEvents.forEach(event => {
                    const eventDate = new Date(event.dateTime);
                    const timeDiff = eventDate - now;
                    const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 3 –¥–Ω—è
                    if (daysDiff === 3) {
                        const notificationId = `${event.id}-3days`;
                        if (!this.activeNotifications.find(n => n.id === notificationId)) {
                            newNotifications.push({
                                id: notificationId,
                                eventId: event.id,
                                eventTitle: event.title,
                                type: '3days',
                                message: `–î–æ —Å–æ–±—ã—Ç–∏—è "${event.title}" –æ—Å—Ç–∞–ª–æ—Å—å 3 –¥–Ω—è`,
                                createdAt: new Date().toISOString(),
                                read: false
                            });
                        }
                    }

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 1 –¥–µ–Ω—å
                    if (daysDiff === 1) {
                        const notificationId = `${event.id}-1day`;
                        if (!this.activeNotifications.find(n => n.id === notificationId)) {
                            newNotifications.push({
                                id: notificationId,
                                eventId: event.id,
                                eventTitle: event.title,
                                type: '1day',
                                message: `–î–æ —Å–æ–±—ã—Ç–∏—è "${event.title}" –æ—Å—Ç–∞–ª–æ—Å—å 1 –¥–µ–Ω—å`,
                                createdAt: new Date().toISOString(),
                                read: false
                            });
                        }
                    }

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –¥–µ–Ω—å —Å–æ–±—ã—Ç–∏—è
                    if (daysDiff === 0 && timeDiff > 0) {
                        const notificationId = `${event.id}-today`;
                        if (!this.activeNotifications.find(n => n.id === notificationId)) {
                            newNotifications.push({
                                id: notificationId,
                                eventId: event.id,
                                eventTitle: event.title,
                                type: 'today',
                                message: `–°–µ–≥–æ–¥–Ω—è: "${event.title}"`,
                                createdAt: new Date().toISOString(),
                                read: false
                            });
                        }
                    }
                });

                if (newNotifications.length > 0) {
                    this.activeNotifications = [...this.activeNotifications, ...newNotifications];
                    storage.set('activeNotifications', this.activeNotifications);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ
                    if (Notification.permission === 'granted') {
                        newNotifications.forEach(notification => {
                            new Notification('Event Timer', {
                                body: notification.message,
                                icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%238B5CF6" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>'
                            });
                        });
                    }
                }
            }

            markNotificationAsRead(notificationId) {
                this.activeNotifications = this.activeNotifications.map(notification =>
                    notification.id === notificationId ? { ...notification, read: true } : notification
                );
                storage.set('activeNotifications', this.activeNotifications);
                this.render();
            }

            deleteNotification(notificationId) {
                this.activeNotifications = this.activeNotifications.filter(n => n.id !== notificationId);
                storage.set('activeNotifications', this.activeNotifications);
                this.render();
            }

            getUnreadNotificationsCount() {
                try {
                    return this.activeNotifications ? this.activeNotifications.filter(n => !n.read).length : 0;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', error);
                    return 0;
                }
            }

            requestNotificationPermission() {
                if ('Notification' in window) {
                    Notification.requestPermission().then(permission => {
                        console.log('–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', permission);
                        if (permission === 'granted') {
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                            setTimeout(() => {
                                try {
                                    new Notification('Event Timer ‚úÖ', {
                                        body: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –≤–∫–ª—é—á–µ–Ω—ã! –¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö.',
                                        icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJDNi40NzcgMiAyIDYuNDc3IDIgMTJzNC40NzcgMTAgMTAgMTAgMTAtNC40NzcgMTAtMTBTMTcuNTIzIDIgMTIgMnoiIGZpbGw9IiM4QjVDRjYiLz4KPHBhdGggZD0iTTkgMTJsMS41IDEuNUwxNSA5IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiLz4KPC9zdmc+',
                                        tag: 'event-timer-test',
                                        requireInteraction: false
                                    });
                                } catch (error) {
                                    console.log('–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–∫–∞–∑–∞—Ç—å:', error);
                                }
                            }, 500);
                        }
                        this.render();
                    }).catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π:', error);
                        this.render();
                    });
                } else {
                    console.log('–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è');
                }
            }

            // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            getDaysInMonth(year, month) {
                return new Date(year, month + 1, 0).getDate();
            }

            getFirstDayOfMonth(year, month) {
                return new Date(year, month, 1).getDay();
            }

            getEventsForDate(date) {
                const dateStr = date.toISOString().split('T')[0];
                return this.getAllEvents().filter(event => event.dateTime.split('T')[0] === dateStr);
            }

            changeMonth(direction) {
                if (direction === 'prev') {
                    if (this.currentMonth === 0) {
                        this.currentMonth = 11;
                        this.currentYear--;
                    } else {
                        this.currentMonth--;
                    }
                } else {
                    if (this.currentMonth === 11) {
                        this.currentMonth = 0;
                        this.currentYear++;
                    } else {
                        this.currentMonth++;
                    }
                }
                this.render();
            }

            renderTimerDisplay(event) {
                return `<div data-timer-event="${event.id}">${this.renderTimerDisplayOnly(event)}</div>`;
            }

            renderTimerDisplayOnly(event) {
                const timeLeft = this.calculateTimeLeft(event.dateTime);
                
                if (timeLeft.expired) {
                    return `<div class="text-red-400 font-semibold">–°–æ–±—ã—Ç–∏–µ –ø—Ä–æ—à–ª–æ</div>`;
                }

                return `
                    <div class="grid grid-cols-4 gap-2 text-center">
                        <div class="bg-white/10 rounded-lg p-2">
                            <div class="text-lg font-bold">${timeLeft.days}</div>
                            <div class="text-xs opacity-70">–¥–Ω–µ–π</div>
                        </div>
                        <div class="bg-white/10 rounded-lg p-2">
                            <div class="text-lg font-bold">${timeLeft.hours}</div>
                            <div class="text-xs opacity-70">—á–∞—Å–æ–≤</div>
                        </div>
                        <div class="bg-white/10 rounded-lg p-2">
                            <div class="text-lg font-bold">${timeLeft.minutes}</div>
                            <div class="text-xs opacity-70">–º–∏–Ω</div>
                        </div>
                        <div class="bg-white/10 rounded-lg p-2">
                            <div class="text-lg font-bold animate-pulse">${timeLeft.seconds}</div>
                            <div class="text-xs opacity-70">—Å–µ–∫</div>
                        </div>
                    </div>
                `;
            }

            render() {
                const bgClasses = this.isDark 
                    ? 'bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900' 
                    : 'bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50';
                
                const cardClasses = this.isDark 
                    ? 'bg-gradient-to-br from-purple-800/20 via-pink-800/20 to-gray-800/20 border-purple-500/30' 
                    : 'bg-gradient-to-br from-white/80 via-purple-50/80 to-pink-50/80 border-purple-200';

                const textClasses = this.isDark ? 'text-white' : 'text-gray-900';

                const backgroundStyle = this.backgroundImage 
                    ? (this.backgroundImage.startsWith('linear-gradient') 
                        ? `background: ${this.backgroundImage};`
                        : `background-image: url('${this.backgroundImage}'); background-size: cover; background-position: center; background-attachment: fixed;`)
                    : '';

                const upcomingEvents = this.getUpcomingEvents();

                document.getElementById('app').innerHTML = `
                    <div class="min-h-screen ${bgClasses} ${textClasses} relative overflow-hidden" style="${backgroundStyle}">
                        ${this.backgroundImage ? `<div class="absolute inset-0 ${this.isDark ? 'bg-black/30' : 'bg-white/20'} backdrop-blur-light"></div>` : ''}
                        
                        <div class="relative z-10 flex flex-col h-screen">
                            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                            <div class="flex items-center justify-between p-4 border-b border-purple-500/30">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="clock" class="w-8 h-8 text-purple-400"></i>
                                    <h1 class="text-xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                                        Event Timer
                                    </h1>
                                </div>
                                
                                <div class="flex items-center gap-2">
                                    <button onclick="app.setTheme(!app.isDark)" class="p-2 rounded-full bg-purple-500/20 text-purple-300 hover:bg-purple-500/30 transition-colors">
                                        <i data-lucide="palette" class="w-5 h-5"></i>
                                    </button>
                                    <button onclick="app.currentTab = 'photos'; app.render();" class="p-2 rounded-full bg-purple-500/20 text-purple-300 hover:bg-purple-500/30 transition-colors">
                                        <i data-lucide="image" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
                            <div class="flex-1 overflow-hidden">
                                ${this.renderCurrentTab(cardClasses, upcomingEvents)}
                            </div>

                            <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
                            <div class="border-t border-purple-500/30 ${cardClasses} backdrop-blur-lg safe-area-inset-bottom">
                                <div class="flex items-center justify-around py-3">
                                    ${[
                                        { id: 'home', icon: 'home', label: '–ì–ª–∞–≤–Ω–∞—è' },
                                        { id: 'events', icon: 'list', label: '–°–æ–±—ã—Ç–∏—è' },
                                        { id: 'notifications', icon: 'bell', label: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è' },
                                        { id: 'calendar', icon: 'calendar', label: '–ö–∞–ª–µ–Ω–¥–∞—Ä—å' },
                                        { id: 'photos', icon: 'image', label: '–§–æ—Ç–æ' }
                                    ].map(tab => `
                                        <button onclick="app.currentTab = '${tab.id}'; app.render();" class="flex flex-col items-center gap-1 p-2 rounded-lg transition-all duration-300 relative ${this.currentTab === tab.id ? 'text-purple-400 bg-purple-500/20' : 'text-gray-400 hover:text-purple-300'}">
                                            <i data-lucide="${tab.icon}" class="w-5 h-5"></i>
                                            <span class="text-xs font-medium">${tab.label}</span>
                                            ${tab.id === 'notifications' && this.getUnreadNotificationsCount() > 0 ? `
                                                <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center font-bold animate-pulse">
                                                    ${this.getUnreadNotificationsCount()}
                                                </span>
                                            ` : ''}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>

                            ${this.renderModals(cardClasses)}
                            
                            <!-- –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
                            ${this.currentTab !== 'events' && this.currentTab !== 'photos' ? `
                                <button onclick="app.openNewEventModal();" class="fixed bottom-20 right-4 w-14 h-14 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white shadow-lg hover:shadow-xl transform hover:scale-110 transition-all duration-300 z-40">
                                    <i data-lucide="plus" class="w-6 h-6"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–∫–æ–Ω–∫–∏ Lucide
                lucide.createIcons();
            }

            renderCurrentTab(cardClasses, upcomingEvents) {
                switch (this.currentTab) {
                    case 'home':
                        return `
                            <div class="p-4 space-y-6 overflow-y-auto h-full pb-20">
                                <div class="p-6 rounded-2xl border ${cardClasses} backdrop-blur-lg">
                                    <h2 class="text-2xl font-bold mb-2">Morbidx!, üëã</h2>
                                    <p class="opacity-80">–£ –≤–∞—Å ${this.events.length} —Å–æ–±—ã—Ç–∏–π, ${upcomingEvents.length} –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö</p>
                                </div>

                                ${upcomingEvents.length > 0 ? `
                                    <div class="space-y-4">
                                        <h3 class="text-lg font-semibold flex items-center gap-2">
                                            <i data-lucide="clock" class="w-5 h-5 text-purple-400"></i>
                                            –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è
                                        </h3>
                                        
                                        ${upcomingEvents.map(event => `
                                            <div class="p-4 rounded-xl border ${cardClasses} backdrop-blur-lg ${event.isStatic ? 'ring-2 ring-purple-400/50' : ''}" ${event.color ? `style="border-color: ${event.color}40;"` : ''}>
                                                <div class="flex items-start justify-between mb-3">
                                                    <div>
                                                        <div class="flex items-center gap-2">
                                                            <h4 class="font-semibold text-lg">${event.title}</h4>
                                                            ${event.isStatic ? '<span class="px-2 py-1 text-xs bg-purple-500/20 text-purple-300 rounded-full">–†–µ–≥—É–ª—è—Ä–Ω–æ</span>' : ''}
                                                        </div>
                                                        <p class="text-sm opacity-70">
                                                            ${new Date(event.dateTime).toLocaleDateString('ru-RU', {
                                                                day: 'numeric',
                                                                month: 'long',
                                                                year: 'numeric',
                                                                hour: '2-digit',
                                                                minute: '2-digit'
                                                            })}
                                                        </p>
                                                        ${event.description ? `<p class="text-sm opacity-60 mt-1">${event.description}</p>` : ''}
                                                    </div>
                                                    ${event.color && event.color !== '#8B5CF6' ? `
                                                        <div class="w-4 h-4 rounded-full border-2 border-white/30" style="background-color: ${event.color};"></div>
                                                    ` : ''}
                                                </div>
                                                
                                                ${this.renderTimerDisplay(event)}
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : `
                                    <div class="p-6 rounded-2xl border ${cardClasses} backdrop-blur-lg text-center">
                                        <i data-lucide="calendar" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
                                        <h3 class="text-xl font-semibold mb-2">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</h3>
                                        <p class="opacity-70 mb-4">–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–µ –ø–µ—Ä–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ!</p>
                                        <button onclick="app.openNewEventModal();" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-xl font-semibold hover:from-purple-600 hover:to-pink-600 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                                            –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ
                                        </button>
                                    </div>
                                `}
                            </div>
                        `;

                    case 'events':
                        return `
                            <div class="p-4 space-y-4 overflow-y-auto h-full pb-20">
                                <div class="flex items-center justify-between">
                                    <h2 class="text-xl font-bold flex items-center gap-2">
                                        <i data-lucide="list" class="w-6 h-6 text-purple-400"></i>
                                        –í—Å–µ —Å–æ–±—ã—Ç–∏—è (${this.events.length})
                                    </h2>
                                    <button onclick="app.openNewEventModal();" class="p-2 rounded-full bg-purple-500 text-white hover:bg-purple-600 transition-colors">
                                        <i data-lucide="plus" class="w-5 h-5"></i>
                                    </button>
                                </div>

                                ${this.events.length > 0 ? `
                                    <div class="space-y-3">
                                        ${this.events
                                            .sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime))
                                            .map(event => `
                                                <div class="p-4 rounded-xl border ${cardClasses} backdrop-blur-lg">
                                                    <div class="flex items-start justify-between mb-3">
                                                        <div class="flex-1">
                                                            <h4 class="font-semibold text-lg">${event.title}</h4>
                                                            <p class="text-sm opacity-70">
                                                                ${new Date(event.dateTime).toLocaleDateString('ru-RU', {
                                                                    day: 'numeric',
                                                                    month: 'long',
                                                                    year: 'numeric',
                                                                    hour: '2-digit',
                                                                    minute: '2-digit'
                                                                })}
                                                            </p>
                                                            ${event.description ? `<p class="text-sm opacity-80 mt-1">${event.description}</p>` : ''}
                                                        </div>
                                                        
                                                        <div class="flex items-center gap-2">
                                                            <button onclick="app.startEditEvent('${event.id}')" class="p-2 rounded-lg bg-blue-500/20 text-blue-300 hover:bg-blue-500/30 transition-colors">
                                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                                            </button>
                                                            <button onclick="app.deleteEvent('${event.id}')" class="p-2 rounded-lg bg-red-500/20 text-red-300 hover:bg-red-500/30 transition-colors">
                                                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    
                                                    ${this.renderTimerDisplay(event)}
                                                </div>
                                            `).join('')}
                                    </div>
                                ` : `
                                    <div class="p-6 rounded-2xl border ${cardClasses} backdrop-blur-lg text-center">
                                        <i data-lucide="list" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
                                        <h3 class="text-xl font-semibold mb-2">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π</h3>
                                        <p class="opacity-70">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–µ –ø–µ—Ä–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ!</p>
                                    </div>
                                `}
                            </div>
                        `;

                    case 'photos':
                        return `
                            <div class="p-4 space-y-4 overflow-y-auto h-full pb-20">
                                <div class="flex items-center justify-between">
                                    <h2 class="text-xl font-bold flex items-center gap-2">
                                        <i data-lucide="image" class="w-6 h-6 text-purple-400"></i>
                                        –ú–æ–∏ —Ñ–æ—Ç–æ (${this.userPhotos.length})
                                    </h2>
                                    <label class="p-2 rounded-full bg-purple-500 text-white hover:bg-purple-600 transition-colors cursor-pointer">
                                        <i data-lucide="plus" class="w-5 h-5"></i>
                                        <input type="file" accept="image/*" class="hidden" onchange="app.handleFileUpload(event)">
                                    </label>
                                </div>

                                <!-- –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã -->
                                <div class="space-y-3">
                                    <h3 class="text-lg font-semibold">–ì–æ—Ç–æ–≤—ã–µ —Ñ–æ–Ω—ã</h3>
                                    <div class="photo-grid">
                                        ${[
                                            { id: 'gradient1', name: '–§–∏–æ–ª–µ—Ç–æ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç', style: 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);', value: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' },
                                            { id: 'gradient2', name: '–†–æ–∑–æ–≤—ã–π –∑–∞–∫–∞—Ç', style: 'background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);', value: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' },
                                            { id: 'gradient3', name: '–û–∫–µ–∞–Ω', style: 'background: linear-gradient(135deg, #667db6 0%, #0082c8 100%);', value: 'linear-gradient(135deg, #667db6 0%, #0082c8 100%)' },
                                            { id: 'gradient4', name: '–õ–µ—Å', style: 'background: linear-gradient(135deg, #74b9ff 0%, #55a3ff 100%);', value: 'linear-gradient(135deg, #74b9ff 0%, #55a3ff 100%)' },
                                            { id: 'none', name: '–ë–µ–∑ —Ñ–æ–Ω–∞', style: 'background: #374151; border: 2px dashed #9CA3AF;', value: null }
                                        ].map(bg => `
                                            <div class="relative">
                                                <div onclick="app.setBackgroundImage(${bg.value ? `'${bg.value}'` : 'null'})" 
                                                     class="photo-preview rounded-lg border-2 ${this.backgroundImage === bg.value ? 'border-purple-400' : 'border-gray-300'} flex items-center justify-center text-sm font-medium cursor-pointer hover:border-purple-300 transition-colors" 
                                                     style="${bg.style} height: 80px;">
                                                    ${bg.id === 'none' ? '–ë–µ–∑ —Ñ–æ–Ω–∞' : bg.name}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>

                                <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–æ—Ç–æ -->
                                ${this.userPhotos.length > 0 ? `
                                    <div class="space-y-3">
                                        <h3 class="text-lg font-semibold">–í–∞—à–∏ —Ñ–æ—Ç–æ</h3>
                                        <div class="photo-grid">
                                            ${this.userPhotos.map(photo => `
                                                <div class="relative group">
                                                    <img src="${photo.url}" 
                                                         alt="${photo.name}" 
                                                         class="photo-preview rounded-lg border-2 ${this.backgroundImage === photo.url ? 'border-purple-400' : 'border-gray-300'}"
                                                         onclick="app.setBackgroundImage('${photo.url}')">
                                                    
                                                    <button onclick="app.deletePhoto('${photo.id}')" 
                                                            class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                                        <i data-lucide="x" class="w-3 h-3"></i>
                                                    </button>
                                                    
                                                    <div class="absolute bottom-0 left-0 right-0 bg-black/50 text-white text-xs p-1 rounded-b-lg truncate opacity-0 group-hover:opacity-100 transition-opacity">
                                                        ${photo.name}
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : `
                                    <div class="p-6 rounded-2xl border ${cardClasses} backdrop-blur-lg text-center">
                                        <i data-lucide="image" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
                                        <h3 class="text-xl font-semibold mb-2">–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ</h3>
                                        <p class="opacity-70 mb-4">–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è —Ñ–æ–Ω–∞</p>
                                        <label class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-xl font-semibold hover:from-purple-600 hover:to-pink-600 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 cursor-pointer inline-block">
                                            –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
                                            <input type="file" accept="image/*" class="hidden" onchange="app.handleFileUpload(event)">
                                        </label>
                                    </div>
                                `}
                            </div>
                        `;

                    case 'notifications':
                        return `
                            <div class="p-4 space-y-4 overflow-y-auto h-full pb-20">
                                <div class="flex items-center justify-between">
                                    <h2 class="text-xl font-bold flex items-center gap-2">
                                        <i data-lucide="bell" class="w-6 h-6 text-purple-400"></i>
                                        –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ${this.getUnreadNotificationsCount() > 0 ? `(${this.getUnreadNotificationsCount()})` : ''}
                                    </h2>
                                </div>

                                <div class="space-y-4">
                                    ${!('Notification' in window) ? `
                                        <div class="p-4 rounded-xl bg-orange-500/20 border border-orange-400/30 ${cardClasses}">
                                            <div class="flex items-start gap-3">
                                                <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-400 mt-0.5"></i>
                                                <div>
                                                    <h4 class="font-semibold text-orange-300">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</h4>
                                                    <p class="text-sm opacity-80 mt-1">–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>
                                                </div>
                                            </div>
                                        </div>
                                    ` : Notification.permission === 'default' ? `
                                        <div class="p-4 rounded-xl bg-blue-500/20 border border-blue-400/30 ${cardClasses}">
                                            <div class="flex items-start gap-3">
                                                <i data-lucide="info" class="w-5 h-5 text-blue-400 mt-0.5"></i>
                                                <div>
                                                    <h4 class="font-semibold text-blue-300">–†–∞–∑—Ä–µ—à–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h4>
                                                    <p class="text-sm opacity-80 mt-1">–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö, –Ω–∞–∂–º–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å"</p>
                                                    <div class="flex gap-2 mt-3">
                                                        <button onclick="app.requestNotificationPermission()" class="px-4 py-2 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600 transition-colors">
                                                            –†–∞–∑—Ä–µ—à–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                                                        </button>
                                                        <button onclick="app.testNotification()" class="px-4 py-2 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600 transition-colors">
                                                            –¢–µ—Å—Ç
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ` : Notification.permission === 'granted' ? `
                                        <div class="p-4 rounded-xl bg-green-500/20 border border-green-400/30 ${cardClasses}">
                                            <div class="flex items-start gap-3">
                                                <i data-lucide="check-circle" class="w-5 h-5 text-green-400 mt-0.5"></i>
                                                <div class="flex-1">
                                                    <h4 class="font-semibold text-green-300">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã ‚úÖ</h4>
                                                    <p class="text-sm opacity-80 mt-1">–í—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö</p>
                                                </div>
                                                <button onclick="app.testNotification()" class="px-3 py-1 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 transition-colors">
                                                    –¢–µ—Å—Ç
                                                </button>
                                            </div>
                                        </div>
                                    ` : Notification.permission === 'denied' ? `
                                        <div class="p-4 rounded-xl bg-red-500/20 border border-red-400/30 ${cardClasses}">
                                            <div class="flex items-start gap-3">
                                                <i data-lucide="alert-triangle" class="w-5 h-5 text-red-400 mt-0.5"></i>
                                                <div>
                                                    <h4 class="font-semibold text-red-300">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã</h4>
                                                    <p class="text-sm opacity-80 mt-1">–†–∞–∑—Ä–µ—à–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</p>
                                                </div>
                                            </div>
                                        </div>
                                    ` : ''}

                                    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
                                    <div class="p-4 rounded-xl border ${cardClasses} backdrop-blur-lg">
                                        <h4 class="font-semibold mb-3 flex items-center gap-2">
                                            <i data-lucide="settings" class="w-5 h-5 text-purple-400"></i>
                                            –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                                        </h4>
                                        
                                        <div class="flex items-center justify-between mb-4 p-3 rounded-lg ${this.isDark ? 'bg-gray-800/50' : 'bg-purple-50/50'}">
                                            <span class="text-sm font-medium">–í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                                            <button onclick="app.toggleNotifications()" class="relative inline-flex items-center w-11 h-6 rounded-full transition-colors ${this.notificationsEnabled ? 'bg-purple-500' : 'bg-gray-400'}">
                                                <span class="inline-block w-4 h-4 transform bg-white rounded-full transition-transform ${this.notificationsEnabled ? 'translate-x-6' : 'translate-x-1'}"></span>
                                            </button>
                                        </div>

                                        <div class="space-y-2 text-sm ${this.notificationsEnabled ? 'opacity-80' : 'opacity-40'}">
                                            <div class="flex items-center gap-2">
                                                <i data-lucide="${this.notificationsEnabled ? 'check-circle' : 'x-circle'}" class="w-4 h-4 ${this.notificationsEnabled ? 'text-green-400' : 'text-gray-400'}"></i>
                                                <span>–ó–∞ 3 –¥–Ω—è –¥–æ —Å–æ–±—ã—Ç–∏—è</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <i data-lucide="${this.notificationsEnabled ? 'check-circle' : 'x-circle'}" class="w-4 h-4 ${this.notificationsEnabled ? 'text-green-400' : 'text-gray-400'}"></i>
                                                <span>–ó–∞ 1 –¥–µ–Ω—å –¥–æ —Å–æ–±—ã—Ç–∏—è</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <i data-lucide="${this.notificationsEnabled ? 'check-circle' : 'x-circle'}" class="w-4 h-4 ${this.notificationsEnabled ? 'text-green-400' : 'text-gray-400'}"></i>
                                                <span>–í –¥–µ–Ω—å —Å–æ–±—ã—Ç–∏—è</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
                                    ${this.activeNotifications.length === 0 ? `
                                        <div class="p-6 rounded-2xl border ${cardClasses} backdrop-blur-lg text-center">
                                            <i data-lucide="bell-off" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
                                            <h3 class="text-xl font-semibold mb-2">–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h3>
                                            <p class="opacity-70">${this.notificationsEnabled ? '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–∞ 3 –¥–Ω—è –∏ 1 –¥–µ–Ω—å –¥–æ –≤–∞—à–∏—Ö —Å–æ–±—ã—Ç–∏–π' : '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö'}</p>
                                        </div>
                                    ` : `
                                        <div class="space-y-3">
                                            <h3 class="text-lg font-semibold flex items-center gap-2">
                                                <i data-lucide="inbox" class="w-5 h-5 text-purple-400"></i>
                                                –ê–∫—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (${this.activeNotifications.length})
                                            </h3>
                                            
                                            ${this.activeNotifications
                                                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                                                .map(notification => `
                                                    <div class="p-4 rounded-xl border ${notification.read ? 'bg-gray-500/10 border-gray-500/30' : 'bg-purple-500/20 border-purple-400/30'} ${cardClasses} transition-all">
                                                        <div class="flex items-start gap-3">
                                                            <div class="flex-1">
                                                                <div class="flex items-center gap-2 mb-2">
                                                                    ${notification.type === '3days' ? `<i data-lucide="calendar" class="w-4 h-4 text-orange-400"></i>` : 
                                                                      notification.type === '1day' ? `<i data-lucide="clock" class="w-4 h-4 text-yellow-400"></i>` :
                                                                      `<i data-lucide="bell-ring" class="w-4 h-4 text-red-400"></i>`}
                                                                    <span class="text-sm font-semibold ${notification.read ? 'opacity-70' : ''}">${notification.eventTitle}</span>
                                                                    ${!notification.read ? `<div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>` : ''}
                                                                </div>
                                                                <p class="text-sm ${notification.read ? 'opacity-50' : 'opacity-80'} mb-2">${notification.message}</p>
                                                                <p class="text-xs opacity-50">
                                                                    ${new Date(notification.createdAt).toLocaleDateString('ru-RU', {
                                                                        day: 'numeric',
                                                                        month: 'short',
                                                                        hour: '2-digit',
                                                                        minute: '2-digit'
                                                                    })}
                                                                </p>
                                                            </div>
                                                            <div class="flex gap-2">
                                                                ${!notification.read ? `
                                                                    <button onclick="app.markNotificationAsRead('${notification.id}')" class="p-2 rounded-lg bg-green-500/20 text-green-300 hover:bg-green-500/30 transition-colors" title="–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ">
                                                                        <i data-lucide="check" class="w-4 h-4"></i>
                                                                    </button>
                                                                ` : ''}
                                                                <button onclick="app.deleteNotification('${notification.id}')" class="p-2 rounded-lg bg-red-500/20 text-red-300 hover:bg-red-500/30 transition-colors" title="–£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ">
                                                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                        </div>
                                    `}
                                </div>
                            </div>
                        `;

                    case 'calendar':
                        const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                            '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
                        const dayNames = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
                        const daysInMonth = this.getDaysInMonth(this.currentYear, this.currentMonth);
                        const firstDay = this.getFirstDayOfMonth(this.currentYear, this.currentMonth);
                        
                        let calendarDays = [];
                        
                        // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—Ü–∞
                        for (let i = 0; i < firstDay; i++) {
                            calendarDays.push('');
                        }
                        
                        // –î–Ω–∏ –º–µ—Å—è—Ü–∞
                        for (let day = 1; day <= daysInMonth; day++) {
                            const date = new Date(this.currentYear, this.currentMonth, day);
                            const events = this.getEventsForDate(date);
                            calendarDays.push({ day, date, events });
                        }

                        return `
                            <div class="p-4 space-y-4 overflow-y-auto h-full pb-20">
                                <div class="flex items-center justify-between">
                                    <h2 class="text-xl font-bold flex items-center gap-2">
                                        <i data-lucide="calendar" class="w-6 h-6 text-purple-400"></i>
                                        –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π
                                    </h2>
                                </div>

                                <div class="p-4 rounded-2xl border ${cardClasses} backdrop-blur-lg">
                                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—è -->
                                    <div class="flex items-center justify-between mb-4">
                                        <button onclick="app.changeMonth('prev')" class="p-2 rounded-lg bg-purple-500/20 text-purple-300 hover:bg-purple-500/30 transition-colors">
                                            <i data-lucide="chevron-left" class="w-5 h-5"></i>
                                        </button>
                                        <h3 class="text-lg font-semibold">
                                            ${monthNames[this.currentMonth]} ${this.currentYear}
                                        </h3>
                                        <button onclick="app.changeMonth('next')" class="p-2 rounded-lg bg-purple-500/20 text-purple-300 hover:bg-purple-500/30 transition-colors">
                                            <i data-lucide="chevron-right" class="w-5 h-5"></i>
                                        </button>
                                    </div>

                                    <!-- –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ -->
                                    <div class="grid grid-cols-7 gap-1 mb-2">
                                        ${dayNames.map(day => `
                                            <div class="text-center text-sm font-medium p-2 opacity-70">
                                                ${day}
                                            </div>
                                        `).join('')}
                                    </div>

                                    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ -->
                                    <div class="grid grid-cols-7 gap-1">
                                        ${calendarDays.map(dayData => {
                                            if (!dayData) {
                                                return '<div class="aspect-square"></div>';
                                            }
                                            
                                            const { day, date, events } = dayData;
                                            const isToday = date.toDateString() === new Date().toDateString();
                                            const hasEvents = events.length > 0;
                                            
                                            return `
                                                <div class="aspect-square p-1">
                                                    <div class="w-full h-full rounded-lg border transition-all ${
                                                        isToday ? 'bg-purple-500 text-white border-purple-400' : 
                                                        hasEvents ? 'bg-purple-500/20 border-purple-400/50 text-purple-300' :
                                                        'border-gray-600/30 hover:border-purple-400/30'
                                                    } flex flex-col items-center justify-center text-sm relative">
                                                        <span class="font-medium">${day}</span>
                                                        ${hasEvents ? `
                                                            <div class="flex gap-1 mt-1">
                                                                ${events.slice(0, 3).map(() => `
                                                                    <div class="w-1 h-1 rounded-full bg-current opacity-80"></div>
                                                                `).join('')}
                                                                ${events.length > 3 ? `<div class="text-xs">+</div>` : ''}
                                                            </div>
                                                        ` : ''}
                                                    </div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>

                                <!-- –°–æ–±—ã—Ç–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è -->
                                ${(() => {
                                    const today = new Date();
                                    const todayEvents = this.getEventsForDate(today);
                                    
                                    if (todayEvents.length > 0) {
                                        return `
                                            <div class="space-y-3">
                                                <h3 class="text-lg font-semibold">–°–æ–±—ã—Ç–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
                                                ${todayEvents.map(event => `
                                                    <div class="p-3 rounded-xl border ${cardClasses} backdrop-blur-lg">
                                                        <div class="flex items-center justify-between">
                                                            <div>
                                                                <h4 class="font-semibold">${event.title}</h4>
                                                                <p class="text-sm opacity-70">
                                                                    ${new Date(event.dateTime).toLocaleTimeString('ru-RU', {
                                                                        hour: '2-digit',
                                                                        minute: '2-digit'
                                                                    })}
                                                                </p>
                                                            </div>
                                                            <button onclick="app.startEditEvent('${event.id}')" class="p-2 rounded-lg bg-blue-500/20 text-blue-300 hover:bg-blue-500/30 transition-colors">
                                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        `;
                                    }
                                    return '';
                                })()}
                            </div>
                        `;

                    default:
                        return `
                            <div class="p-4 flex items-center justify-center h-full">
                                <div class="p-6 rounded-2xl border ${cardClasses} backdrop-blur-lg text-center">
                                    <h3 class="text-xl font-semibold mb-2">–°–∫–æ—Ä–æ –±—É–¥–µ—Ç!</h3>
                                    <p class="opacity-70">–≠—Ç–∞ –≤–∫–ª–∞–¥–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
                                </div>
                            </div>
                        `;
                }
            }

            renderModals(cardClasses) {
                let modals = '';

                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–±—ã—Ç–∏—è
                if (this.showEventModal) {
                    modals += `
                        <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                            <div class="w-full max-w-md p-6 rounded-2xl border ${cardClasses} backdrop-blur-lg modal-form">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-bold">
                                        ${this.editingEvent ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ' : '–ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ'}
                                    </h3>
                                    <button onclick="app.closeEventModal()" class="p-2 rounded-full hover:bg-purple-500/20 transition-colors">
                                        <i data-lucide="x" class="w-5 h-5"></i>
                                    </button>
                                </div>

                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</label>
                                        <input type="text" id="eventTitle" value="${this.eventForm.title}" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ..." 
                                               onfocus="app.isFormActive = true"
                                               onblur="setTimeout(() => app.isFormActive = false, 100)"
                                               onchange="app.updateEventForm('title', this.value)" 
                                               oninput="app.updateEventForm('title', this.value)"
                                               class="w-full p-3 rounded-xl border ${this.isDark ? 'bg-gray-800/50 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'} focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">–î–∞—Ç–∞</label>
                                            <input type="date" id="eventDate" value="${this.eventForm.date}"
                                                   onfocus="app.isFormActive = true"
                                                   onblur="setTimeout(() => app.isFormActive = false, 100)"
                                                   onchange="app.updateEventForm('date', this.value)"
                                                   class="w-full p-3 rounded-xl border ${this.isDark ? 'bg-gray-800/50 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'} focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium mb-2">–í—Ä–µ–º—è</label>
                                            <input type="time" id="eventTime" value="${this.eventForm.time}"
                                                   onfocus="app.isFormActive = true"
                                                   onblur="setTimeout(() => app.isFormActive = false, 100)"
                                                   onchange="app.updateEventForm('time', this.value)"
                                                   class="w-full p-3 rounded-xl border ${this.isDark ? 'bg-gray-800/50 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'} focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-2">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                                        <textarea id="eventDescription" placeholder="–î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ..." rows="3" 
                                                  onfocus="app.isFormActive = true"
                                                  onblur="setTimeout(() => app.isFormActive = false, 100)"
                                                  onchange="app.updateEventForm('description', this.value)"
                                                  oninput="app.updateEventForm('description', this.value)"
                                                  class="w-full p-3 rounded-xl border ${this.isDark ? 'bg-gray-800/50 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'} focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none">${this.eventForm.description}</textarea>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-2">–¶–≤–µ—Ç —Å–æ–±—ã—Ç–∏—è</label>
                                        <div class="flex gap-2 flex-wrap">
                                            ${[
                                                { color: '#8B5CF6', name: '–§–∏–æ–ª–µ—Ç–æ–≤—ã–π' },
                                                { color: '#EF4444', name: '–ö—Ä–∞—Å–Ω—ã–π' },
                                                { color: '#F59E0B', name: '–û—Ä–∞–Ω–∂–µ–≤—ã–π' },
                                                { color: '#10B981', name: '–ó–µ–ª–µ–Ω—ã–π' },
                                                { color: '#3B82F6', name: '–°–∏–Ω–∏–π' },
                                                { color: '#EC4899', name: '–†–æ–∑–æ–≤—ã–π' },
                                                { color: '#6366F1', name: '–ò–Ω–¥–∏–≥–æ' },
                                                { color: '#8B5A3C', name: '–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π' }
                                            ].map(colorOption => `
                                                <button type="button" onclick="app.updateEventForm('color', '${colorOption.color}')" 
                                                        class="w-8 h-8 rounded-full border-2 transition-all hover:scale-110 ${this.eventForm.color === colorOption.color ? 'border-white ring-2 ring-white/50' : 'border-gray-400'}"
                                                        style="background-color: ${colorOption.color};"
                                                        title="${colorOption.name}">
                                                </button>
                                            `).join('')}
                                        </div>
                                    </div>

                                    <div class="flex gap-3 pt-4">
                                        <button onclick="app.closeEventModal()" class="flex-1 py-3 px-4 rounded-xl border border-gray-500 text-gray-400 hover:bg-gray-500/10 transition-colors">
                                            –û—Ç–º–µ–Ω–∞
                                        </button>
                                        ${this.editingEvent ? `
                                            <button onclick="app.deleteCurrentEvent()" class="px-4 py-3 rounded-xl bg-red-500/20 text-red-300 hover:bg-red-500/30 border border-red-500/30 transition-colors">
                                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                                            </button>
                                        ` : ''}
                                        <button onclick="app.saveEvent()" class="flex-1 py-3 px-4 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold hover:from-purple-600 hover:to-pink-600 transition-all duration-300 shadow-lg hover:shadow-xl">
                                            ${this.editingEvent ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }



                return modals;
            }

            // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
            closeEventModal() {
                this.isFormActive = false; // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É
                this.showEventModal = false;
                this.editingEvent = null;
                this.resetForm();
                storage.set('tempEventForm', null); // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ñ–æ—Ä–º—É
                this.render();
            }



            startEditEvent(eventId) {
                const event = this.events.find(e => e.id == eventId);
                if (event) {
                    this.editingEvent = event;
                    this.eventForm = {
                        title: event.title,
                        date: event.dateTime.split('T')[0],
                        time: event.dateTime.split('T')[1],
                        description: event.description || '',
                        color: event.color || '#8B5CF6',
                        notifications: event.notifications || []
                    };
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                    storage.set('tempEventForm', this.eventForm);
                    this.showEventModal = true;
                    this.isFormActive = true; // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É
                    this.render();
                }
            }

            openNewEventModal() {
                this.showEventModal = true;
                this.isFormActive = true; // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É
                this.render();
            }

            updateEventForm(field, value) {
                this.eventForm[field] = value;
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
                const tempForm = { ...this.eventForm };
                storage.set('tempEventForm', tempForm);
            }

            saveEvent() {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ—Ä–º—É –∏–∑ localStorage –µ—Å–ª–∏ –ø–æ—Ç–µ—Ä—è–ª–∏ –¥–∞–Ω–Ω—ã–µ
                const tempForm = storage.get('tempEventForm');
                if (tempForm) {
                    this.eventForm = { ...this.eventForm, ...tempForm };
                }

                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
                const titleEl = document.getElementById('eventTitle');
                const dateEl = document.getElementById('eventDate');
                const timeEl = document.getElementById('eventTime');
                const descEl = document.getElementById('eventDescription');
                
                if (titleEl) this.eventForm.title = titleEl.value;
                if (dateEl) this.eventForm.date = dateEl.value;
                if (timeEl) this.eventForm.time = timeEl.value;
                if (descEl) this.eventForm.description = descEl.value;

                // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ñ–æ—Ä–º—É
                storage.set('tempEventForm', null);

                if (this.editingEvent) {
                    this.editEvent();
                } else {
                    this.addEvent();
                }
            }

            deleteCurrentEvent() {
                if (this.editingEvent && confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ?')) {
                    this.deleteEvent(this.editingEvent.id);
                    this.closeEventModal();
                }
            }

            testNotification() {
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('Event Timer - –¢–µ—Å—Ç üîî', {
                        body: '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ! –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.',
                        icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJDNi40NzcgMiAyIDYuNDc3IDIgMTJzNC40NzcgMTAgMTAgMTAgMTAtNC40NzcgMTAtMTBTMTcuNTIzIDIgMTIgMnoiIGZpbGw9IiM4QjVDRjYiLz4KPHBhdGggZD0iTTkgMTJsMS41IDEuNUwxNSA5IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiLz4KPC9zdmc+',
                        tag: 'event-timer-test-manual',
                        requireInteraction: false
                    });
                } else if (Notification.permission === 'default') {
                    this.requestNotificationPermission();
                } else {
                    alert('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞. –†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –∏—Ö –≤—Ä—É—á–Ω—É—é.');
                }
            }

            handleFileSelect(event) {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    this.handlePhotoUpload(file);
                }
                event.target.value = ''; // –°–±—Ä–æ—Å input –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
            handleFileUpload(event) {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    this.handlePhotoUpload(file);
                }
                event.target.value = '';
            }
        }

        // –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        window.app = new EventTimerApp();

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ—Ç–µ—Ä–∏ —Ñ–æ–∫—É—Å–∞
        document.addEventListener('focusout', (e) => {
            // –ï—Å–ª–∏ —Ñ–æ–∫—É—Å —É—Ö–æ–¥–∏—Ç —Å –ø–æ–ª—è –≤–≤–æ–¥–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
            if (e.target && e.target.closest && e.target.closest('.modal-form')) {
                setTimeout(() => {
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π –∏–∑ localStorage –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ—Ç–µ—Ä—è–ª–∏—Å—å
                    const tempForm = storage.get('tempEventForm');
                    if (tempForm) {
                        const titleEl = document.getElementById('eventTitle');
                        const dateEl = document.getElementById('eventDate');
                        const timeEl = document.getElementById('eventTime');
                        const descEl = document.getElementById('eventDescription');
                        
                        if (titleEl && !titleEl.value && tempForm.title) titleEl.value = tempForm.title;
                        if (dateEl && !dateEl.value && tempForm.date) dateEl.value = tempForm.date;
                        if (timeEl && !timeEl.value && tempForm.time) timeEl.value = tempForm.time;
                        if (descEl && !descEl.value && tempForm.description) descEl.value = tempForm.description;
                    }
                }, 100);
            }
        });
    </script>
</body>
</html>
